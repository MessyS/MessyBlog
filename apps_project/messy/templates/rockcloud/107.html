<p></p><p>【教学资源类别】</p><table border="1" cellspacing="0" style="width:0px">	<tbody>		<tr>			<td style="vertical-align:top; width:142.0pt">			<p><strong>序号</strong></p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p><strong>类别</strong></p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p><strong>打勾&radic;</strong></p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:142.0pt">			<p>1</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>学习资源</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p><strong>&radic;</strong></p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:142.0pt">			<p>2</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>单兵模式赛题资源</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:142.0pt">			<p>3</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>分组对抗赛题资源</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>&nbsp;</p>			</td>		</tr>	</tbody></table><p>&nbsp;【教学资源名称】&nbsp;</p><p>渗透测试常用工具-使用ptunnel进行内网穿透</p><p>&nbsp;【教学资源分类】</p><table border="1" cellspacing="0" style="width:0px">	<tbody>		<tr>			<td style="height:14.0pt; width:106.95pt">			<p><strong>一级大类</strong></p>			</td>			<td style="height:14.0pt; width:237.7pt">			<p><strong>二级大类</strong></p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p><strong>打勾&radic;</strong></p>			</td>		</tr>		<tr>			<td rowspan="5" style="height:14.0pt; width:106.95pt">			<p>1.安全标准</p>			</td>			<td style="height:14.0pt; width:237.7pt">			<p>法律法规</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>行业标准</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>安全意识</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>应急响应</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>安全评估</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td rowspan="2" style="height:14.0pt; width:106.95pt">			<p>2.系统安全</p>			</td>			<td style="height:14.0pt; width:237.7pt">			<p>Windows操作系统安全配置</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>Linux操作系统安全配置</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td rowspan="2" style="height:14.0pt; width:106.95pt">			<p>3.网络安全</p>			</td>			<td style="height:14.0pt; width:237.7pt">			<p>网络设备安全</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>网络协议分析</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td rowspan="7" style="height:14.0pt; width:106.95pt">			<p>4.应用安全</p>			</td>			<td style="height:14.0pt; width:237.7pt">			<p>Web应用安全</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>数据库安全</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:18.35pt; width:237.7pt">			<p>中间件应用安全</p>			</td>			<td style="height:18.35pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>应用层协议分析</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p><strong>&radic;</strong></p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>移动应用安全</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>VPN应用</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>恶意代码分析</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td rowspan="2" style="height:14.0pt; width:106.95pt">			<p>5.密码学</p>			</td>			<td style="height:14.0pt; width:237.7pt">			<p>密码学原理</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>密码学应用</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td rowspan="3" style="height:14.0pt; width:106.95pt">			<p>6.渗透测试</p>			</td>			<td style="height:14.0pt; width:237.7pt">			<p>常用工具</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p><strong>&radic;</strong></p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>脚本编写</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>报告编写</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>	</tbody></table><p>【难度说明】</p><table border="1" cellspacing="0" style="width:0px">	<tbody>		<tr>			<td style="vertical-align:top; width:142.0pt">			<p><strong>序号</strong></p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p><strong>难度等级</strong></p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p><strong>打勾&radic;</strong></p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:142.0pt">			<p>1</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>简单</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:142.0pt">			<p>2</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>一般</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:142.0pt">			<p>3</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>困难</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p><strong>&radic;</strong></p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:142.0pt">			<p>4</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>极难</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>&nbsp;</p>			</td>		</tr>	</tbody></table><p>【背景描述】</p><p>一名黑客在对某企业进行渗透测试，发现一台web服务器存在一处命令执行漏洞，该服务器没有开放ssh，该黑客通过cat命令查询到了web配置文件找到了记录数据库配置文件，得知数据在内网一台服务器内，然后通过wget命令对该服务器下载并安装了ptunnel工具，最终该黑客使用了ptunnle成功拿出了数据。【大多数时候，攻击者使用ptunnle来隐藏踪迹，穿透防火墙，因为防火墙很少会拦截icmp数据包，而且在ping隧道中传输的数据是加密的，为其自身增加了安全性】</p><p>&nbsp;【实训设备】</p><table border="1" cellspacing="0" style="width:0px">	<tbody>		<tr>			<td style="vertical-align:top; width:146.65pt">			<p>产品型号</p>			</td>			<td style="vertical-align:top; width:166.25pt">			<p>产品描述</p>			</td>			<td style="vertical-align:top; width:69.8pt">			<p>数量</p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:146.65pt">			<p>PY-P8</p>			</td>			<td style="vertical-align:top; width:166.25pt">			<p>实训室安全、应用环境实训平台</p>			</td>			<td style="vertical-align:top; width:69.8pt">			<p>1</p>			</td>		</tr>	</tbody></table><p>【预备知识】</p><p>在一些网络环境中，如果不经过认证，TCP和UDP数据包都会被拦截。如果用户可以ping通远程计算机，就可以尝试建立ICMP隧道，将TCP数据通过该隧道发送，实现不受限的网络访问。Backtrack5提供了一款ICMP隧道专用工具ptunnel。用户需要在受限制网络之外，预先启动该工具建立代理服务器。再以客户端模式运行该工具，就可以建立ICMP隧道。为了避免该隧道被滥用，用户还可以为隧道设置使用密码。</p><p>【工具原理】</p><p>一、icmptunnel 可以将 IP 流量封装进 IMCP 的 ping 数据包中，旨在利用 ping 穿透防</p><p>火墙的检测，因为通常防火墙是不会屏蔽 ping 数据包的。</p><p>二、请求端的 Ping 工具会在 ICMP 数据包后面附加上一段随机的数据作为 Payload，而响应端则会拷贝这段 Payload 到 ICMP 响应数据包中返还给请求端，用于识别和匹配 Ping 请求。</p><p>三、在使用ptunnel进行内网穿透时，客户端会将 IP 帧封装在 ICMP 请求数据包中发送给服务器，而服务器端则会使用相匹配的 ICMP 响应数据包进行回复。这样在旁人看来，网络中传播的仅仅只是正常的 ICMP 数据包。</p><p>【实验步骤】</p><p>&nbsp; 网络拓扑：kali--bt5--01-server2003</p><p>&nbsp; bt5&nbsp;<br />&nbsp; 用户：root<br />&nbsp; 密码：toor</p><p>&nbsp; windows server 2003<br />&nbsp; 用户：administrator<br />&nbsp; 密码：123456</p><p>&nbsp; kali<br />&nbsp; 用户：root<br />&nbsp; 密码：toor</p><p><strong>【第一步】点击启动选项，启动实验虚拟机。</strong></p><p><strong>【第二步】获取操作机和靶机的IP</strong></p><p>&nbsp;&nbsp; 操作机：<strong>ifconfig</strong></p><p>&nbsp;&nbsp; 跳板机：<strong>ifconfig</strong></p><p>&nbsp;&nbsp; <img src="api/attachment?type=courseDocument&amp;id=2277" style="height:231px; width:522px" /></p><p>&nbsp;&nbsp; 靶机：ipconfig</p><p>BT5：通过ifconfig获取</p><p>【<strong>使用到的命令</strong>】</p><p>Kali:通过ifconfig获取</p><p>Windows Server：通过ipconfig获取</p><p><strong>【第三步】查看ptunnle帮助信息</strong></p><p>我们先看一下ptunnle使用帮助信息，我们先切换目录cd至/pentest/backdoors/ptunnle,</p><p>然后使用man ptunnle命令查看ptunnel帮助信息。</p><p><strong>【所使用到的命令】</strong></p><p>1：【cd /pentest/backdoors/ptunnel】切换到该工具所在目录</p><p>2：【man ptunnle】查看帮助信息</p><p><strong>回显客户端命令列表：</strong></p><p>1：【-p】代理服务器地址</p><p>2：【-lp】本地端口</p><p>3：【-da】目标内网IP</p><p>4：【-dp】目标端口</p><p><strong>【回显服务端命令列表】</strong></p><p><strong>【标注】</strong>net available on windows标识是需要在windows下使用，本次实验不涉及</p><p>1：【-c】网卡编号</p><p>2：【-v】显示详细过程，值可以-1-5，-1为不显示，5为最详细】</p><p>2：【-u】dp【通过dns协议传输，端口为udp53】</p><p>3：【-x】进入此隧道密码，如果服务器加该参数，客户端也需要加同样参数和值】</p><p>4：【-f】指定一个日志文件</p><p><strong>【第四步】运行ptunnel</strong></p><p>我们先在代理服务器【kali linux ip:192.168.0.108】上运行ptunnel</p><p><strong>【所使用到的命令】</strong></p><p>【ptunnel -v 5 -x 123456】</p><p>【-v 5】显示详细信息</p><p>【-x 123456】隧道密码123456</p><p>&nbsp;</p><p><strong>【第五步】抓取靶机流量包</strong></p><p>打开靶机【win2003 ip：192.168.0.105】我们需要在win2003上打开mysql，然后打开</p><p>wireshark抓包并且过滤3306端口数据包，然后netstat -an查看3306【mysql默认端口</p><p>是否在监听】</p><p><strong>【所使用到的命令】</strong></p><p>【tcp.port eq 3306】过滤只显示tcp端口为3306的数据包</p><p>【netstat -an】列表里tcp 0.0.0.0:3306 listening状态说明本地3306在监听状态</p><p><strong>【第六步】打开渗透测试机建立隧道</strong></p><p>打开终端，切换至工具目录cd /pentest/backdoors/ptunnel，执行连接跳板机：</p><p>【./ptunnel -p 192.168.0.108 -lp 1080 -da 192.168.0.105 -dp 3306 -x 123456】</p><p>【./ptunnel -p 192.168.0.108】跳板机ip ：192.168.0.108</p><p>【-lp】本地端口：1080</p><p>【-da】需要通过跳板机连接的靶机ip)192.168.0. 105 -dp (靶机的端口，此处可以映射</p><p>为对方任意开放端口，例如3389)3306</p><p>【-x】进入隧道密码，我们在跳板机输入的那个123456 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p><strong>【所使用到的命令】</strong></p><p>【cd /pentest/backdoors/ptunnel】切换至工具目录</p><p>【./ptunnel -p 192.168.0.108 -lp 1080 -da 192.168.0.105 -dp 3306 -x 123456】</p><p>启动工具并建立隧道</p><p>&nbsp;</p><p><strong>【第七步】：测试通过隧道传输至跳板机，再由跳板机转发至靶机</strong></p><p>使用mysql -h(主机) 127.0.0.1 -P(指定端口)1080 -u （靶机的账号root） -p (密码在</p><p>输入完-p 回车后再输入)，回车后输入密码root成功连接至靶机</p><p><strong>【所使用到的命令】</strong></p><p>【mysql -h 127.0.0.1 -P 1080 -u root -p】登陆mysql</p><p>&nbsp;</p><p><strong>【第八步】：分析wireshark抓取的流量</strong></p><p>我们查看靶机流量，请求内网mysql的流量均由跳板机【192.168.0.108】发出，也就是说内网的mysql流量被转发到了跳板机，再由跳板机发出，实现了跳板机到内网，再由内网到跳板机的通信，由此也就穿透了内网限制，实现直接访问跳板机就可访问到内网。</p><p>&nbsp;</p><p>实验结束，关闭虚拟机。</p>
<p></p><p>【教学资源类别】</p><table border="1" cellspacing="0" style="width:100.0%">	<tbody>		<tr>			<td style="vertical-align:top; width:33.32%">			<p>序号</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>类别</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>打勾&radic;</p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:33.32%">			<p>1</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>学习资源</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>&radic;</p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:33.32%">			<p>2</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>单兵模式赛题资源</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:33.32%">			<p>3</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>分组对抗赛题资源</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>&nbsp;</p>			</td>		</tr>	</tbody></table><p>&nbsp;【教学资源名称】&nbsp;</p><p>&nbsp; 应用层协议分析-通过Windows2003网络服务搭建SNMP协议分析</p><p>&nbsp;【教学资源分类】</p><table border="1" cellspacing="0" style="width:100.0%">	<tbody>		<tr>			<td style="height:14.0pt; width:25.1%">			<p>一级大类</p>			</td>			<td style="height:14.0pt; width:55.78%">			<p>二级大类</p>			</td>			<td style="height:14.0pt; width:19.12%">			<p>打勾&radic;</p>			</td>		</tr>		<tr>			<td rowspan="5" style="height:14.0pt; width:25.1%">			<p>1.安全标准</p>			</td>			<td style="height:14.0pt; width:55.78%">			<p>法律法规</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td style="height:14.0pt; width:55.78%">			<p>行业标准</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td style="height:14.0pt; width:55.78%">			<p>安全意识</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td style="height:14.0pt; width:55.78%">			<p>应急响应</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td style="height:14.0pt; width:55.78%">			<p>安全评估</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td rowspan="2" style="height:14.0pt; width:25.1%">			<p>2.系统安全</p>			</td>			<td style="height:14.0pt; width:55.78%">			<p>Windows操作系统安全配置</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td style="height:14.0pt; width:55.78%">			<p>Linux操作系统安全配置</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td rowspan="2" style="height:14.0pt; width:25.1%">			<p>3.网络安全</p>			</td>			<td style="height:14.0pt; width:55.78%">			<p>网络设备安全</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td style="height:14.0pt; width:55.78%">			<p>网络协议分析</p>			</td>			<td style="height:14.0pt; width:19.12%">			<p>&radic;</p>			</td>		</tr>		<tr>			<td rowspan="7" style="height:14.0pt; width:25.1%">			<p>4.应用安全</p>			</td>			<td style="height:14.0pt; width:55.78%">			<p>Web应用安全</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td style="height:14.0pt; width:55.78%">			<p>数据库安全</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td style="height:14.0pt; width:55.78%">			<p>中间件应用安全</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td style="height:14.0pt; width:55.78%">			<p>应用层协议分析</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td style="height:14.0pt; width:55.78%">			<p>移动应用安全</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td style="height:14.0pt; width:55.78%">			<p>VPN应用</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td style="height:14.0pt; width:55.78%">			<p>恶意代码分析</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td rowspan="2" style="height:14.0pt; width:25.1%">			<p>5.密码学</p>			</td>			<td style="height:14.0pt; width:55.78%">			<p>密码学原理</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td style="height:14.0pt; width:55.78%">			<p>密码学应用</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td rowspan="3" style="height:14.0pt; width:25.1%">			<p>6.渗透测试</p>			</td>			<td style="height:14.0pt; width:55.78%">			<p>常用工具</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td style="height:14.0pt; width:55.78%">			<p>脚本编写</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td style="height:14.0pt; width:55.78%">			<p>报告编写</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>	</tbody></table><p>【难度说明】</p><table border="1" cellspacing="0" style="width:100.0%">	<tbody>		<tr>			<td style="vertical-align:top; width:33.32%">			<p>序号</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>难度等级</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>打勾&radic;</p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:33.32%">			<p>1</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>简单</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>&radic;</p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:33.32%">			<p>2</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>一般</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:33.32%">			<p>3</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>困难</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:33.32%">			<p>4</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>极难</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>&nbsp;</p>			</td>		</tr>	</tbody></table><p>【背景描述】</p><p>XX企业，为加强信息化建设，组建了企业内部网络，用于自身网站的建设，小王是该企业新进网管，承担网络的管理工作。</p><p>现该企业网络存在如下需求：</p><p>通过企业网络NIDS分析，经常发现网络中出现针对SNMP服务的Community暴力破解攻击，造成SNMP服务的非法访问，针对此问题，需要提出针对此攻击的解决方案，再次之前，需要首先对SNMP协议的工作原理进行研究。</p><p>【实训设备】</p><table border="1" cellspacing="0">	<tbody>		<tr>			<td style="vertical-align:top; width:4.0cm">			<p>产品型号</p>			</td>			<td style="vertical-align:top; width:199.5pt">			<p>产品描述</p>			</td>			<td style="vertical-align:top; width:69.8pt">			<p>数量</p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:4.0cm">			<p>PY-P8</p>			</td>			<td style="vertical-align:top; width:199.5pt">			<p>实训室安全、应用环境实训平台</p>			</td>			<td style="vertical-align:top; width:69.8pt">			<p>1</p>			</td>		</tr>	</tbody></table><p>【预备知识】</p><p>&nbsp;&nbsp;&nbsp; 简单网络管理协议（SNMP），由一组网络管理的标准组成，包含一个应用层协议（application layer protocol）、数据库模型（database schema）和一组资源对象。该协议能够支持网络管理系统，用以监测连接到网络上的设备是否有任何引起管理上关注的情况。该协议是互联网工程工作小组（IETF，Internet Engineering Task Force）定义的internet协议簇的一部分。SNMP的目标是管理互联网Internet上众多厂家生产的软硬件平台，因此SNMP受Internet标准网络管理框架的影响也很大。SNMP已经出到第三个版本的协议，其功能较以前已经大大地加强和改进了。</p><p>&nbsp;&nbsp;&nbsp; SNMP五种协议数据单元</p><p>SNMP规定了5种协议数据单元PDU（也就是SNMP报文），用来在管理进程和代理之间的交换。</p><p>get-request操作：从代理进程处提取一个或多个参数值(网管系统发送)</p><p>get-next-request操作：从代理进程处提取紧跟当前参数值的下一个参数值(网管系统发送)</p><p>set-request操作：设置代理进程的一个或多个参数值(网管系统发送)</p><p>get-response操作：返回的一个或多个参数值。这个操作是由代理进程发出的，它是前面三种操作的响应操作(代理发送)</p><p>trap操作：代理进程主动发出的报文，通知管理进程有某些事情发生(代理发送)</p><p>前面的3种操作是由管理进程向代理进程发出的，后面的2个操作是代理进程发给管理进程的，为了简化起见，前面3个操作叫做get、get-next和set操作。下图描述了SNMP的这5种报文操作。请注意，在代理进程端是用熟知端口161俩接收get或set报文，而在管理进程端是用熟知端口162来接收trap报文。</p><p>&nbsp;</p><p>SNMP协议数据单元格式解析</p><p>下图封装成UDP数据报的5种操作的SNMP报文格式。可见一个SNMP报文共有三个部分组成，即公共SNMP首部、get/set首部trap首部、变量绑定。</p><p>1. 公共SNMP首部</p><p>1.1 版本</p><p>写入版本字段的是版本号减1，对于SNMP（即SNMPV1）则应写入0。</p><p>1.2 公共体</p><p>共同体就是一个字符串，作为管理进程和代理进程之间的明文口令，常用的是6个字符&ldquo;public&rdquo;。</p><p>1.3 PDU类型</p><p>根据PDU的类型，填入0～4中的一个数字，其对应关系下表所示意图。</p><p>PDU类型 名称</p><p>0&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; get-request</p><p>1&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; get-next-request</p><p>2&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; get-response</p><p>3&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; set-request</p><p>4&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; trap</p><p>2. get/set首部</p><p>2.1 请求标识符(request ID)</p><p>这是由管理进程设置的一个整数值。代理进程在发送get-response报文时也要返回此请求标识符。管理进程可同时向许多代理发出get报文，这些报文都使用UDP传送，先发送的有可能后到达。设置了请求标识符可使管理进程能够识别返回的响应报文对于哪一个请求报文。</p><p>2.2 差错状态(error status)</p><p>由代理进程回答时填入0～5中的一个数字，见下表的描述。</p><p>差错状态&nbsp;&nbsp; 名字&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 说明</p><p>0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; noError&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; 一切正常</p><p>1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tooBig &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 代理无法将回答装入到一个SNMP报文之中</p><p>2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; noSuchName &nbsp;&nbsp;&nbsp; 操作指明了一个不存在的变量</p><p>3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; badValue&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; 一个set操作指明了一个无效值或无效语法</p><p>4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readOnly&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; 管理进程试图修改一个只读变量</p><p>5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; genErr &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 某些其他的差错</p><p>2.3 差错索引(error index)</p><p>当出现noSuchName、badValue或readOnly的差错时，由代理进程在回答时设置的一个整数，它指明有差错的变量在变量列表中的偏移。</p><p>3. trap首部</p><p>3.1 企业(enterprise)</p><p>填入trap报文的网络设备的对象标识符。此对象标识符肯定是在图3的对象命名树上的enterprise结点{1.3.6.1.4.1}下面的一棵子树上。</p><p>3.2 trap类型</p><p>此字段正式的名称是generic-trap，共分为表中的7种。</p><p>trap类型&nbsp; 名字&nbsp;&nbsp; 说明</p><p>0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; coldStart&nbsp; 代理进行了初始化</p><p>1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; warmStart&nbsp; 代理进行了重新初始化</p><p>2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; linkDown&nbsp;&nbsp; 一个接口从工作状态变为故障状态</p><p>3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; linkUp 一个接口从故障状态变为工作状态</p><p>4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; authenticationFailure&nbsp;&nbsp;&nbsp; 从SNMP管理进程接收到具有一个无效共同体的报文</p><p>5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; egpNeighborLoss&nbsp;&nbsp; 一个EGP相邻路由器变为故障状态</p><p>6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; enterpriseSpecific&nbsp;&nbsp; 代理自定义的事件，需要用后面的&ldquo;特定代码&rdquo;来指明</p><p>当使用上述类型2、3、5时，在报文后面变量部分的第一个变量应标识响应的接口。</p><p>3.3 特定代码(specific-code)</p><p>指明代理自定义的时间（若trap类型为6），否则为0。</p><p>3.4 时间戳(timestamp)</p><p>指明自代理进程初始化到trap报告的事件发生所经历的时间，单位为10ms。例如时间戳为1908表明在代理初始化后1908ms发生了该时间。</p><p>4. 变量绑定(variable-bindings)</p><p>指明一个或多个变量的名和对应的值。在get或get-next报文中，变量的值应忽略。</p><p>【实验步骤】</p><p>网络拓扑：BackTrack5--Windows2003</p><p>bt5&nbsp;<br />用户：root<br />密码：toor</p><p>windows server 2003<br />用户：administrator<br />密码：空</p><p>第一步：配置服务器的IP地址</p><p>服务器：192.168.1.121</p><p>（图略）</p><p>第二步：确保服务器安装了SNMP服务</p><p>第三步：配置SNMP服务的属性</p><p>第四步：测试服务器SNMP服务的访问</p><p>1、在客户机编辑文档windows.txt</p><p>2、运行渗透测试程序snmpenum.pl访问服务器SNMP服务</p><p>第五步：打开WireShark程序，并配置过滤条件</p><p>第六步：测试服务器SNMP服务的访问</p><p>1、在客户机编辑文档windows.txt</p><p>2、运行渗透测试程序snmpenum.pl访问服务器SNMP服务</p><p>第七步：打开WireShark，对照预备知识，分析下列SNMP报文</p><p>1、分析getBulkRequest报文</p><p>2、分析get-response报文</p><p>&nbsp;</p><p>&nbsp;</p><p>实验结束，关闭虚拟机。</p>
<p></p><p>【教学资源类别】</p><table border="1" cellspacing="0" style="width:0px">	<tbody>		<tr>			<td style="vertical-align:top; width:142.0pt">			<p><strong>序号</strong></p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p><strong>类别</strong></p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p><strong>打勾&radic;</strong></p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:142.0pt">			<p>1</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>学习资源</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p><strong>&radic;</strong></p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:142.0pt">			<p>2</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>单兵模式赛题资源</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:142.0pt">			<p>3</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>分组对抗赛题资源</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>&nbsp;</p>			</td>		</tr>	</tbody></table><p>&nbsp;【教学资源名称】&nbsp;</p><p>渗透测试常用工具-使用ettercap进行局域网攻击</p><p>&nbsp;【教学资源分类】</p><table border="1" cellspacing="0" style="width:0px">	<tbody>		<tr>			<td style="height:14.0pt; width:106.95pt">			<p><strong>一级大类</strong></p>			</td>			<td style="height:14.0pt; width:237.7pt">			<p><strong>二级大类</strong></p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p><strong>打勾&radic;</strong></p>			</td>		</tr>		<tr>			<td rowspan="5" style="height:14.0pt; width:106.95pt">			<p>1.安全标准</p>			</td>			<td style="height:14.0pt; width:237.7pt">			<p>法律法规</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>行业标准</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>安全意识</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>应急响应</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>安全评估</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td rowspan="2" style="height:14.0pt; width:106.95pt">			<p>2.系统安全</p>			</td>			<td style="height:14.0pt; width:237.7pt">			<p>Windows操作系统安全配置</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>Linux操作系统安全配置</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td rowspan="2" style="height:14.0pt; width:106.95pt">			<p>3.网络安全</p>			</td>			<td style="height:14.0pt; width:237.7pt">			<p>网络设备安全</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>网络协议分析</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td rowspan="7" style="height:14.0pt; width:106.95pt">			<p>4.应用安全</p>			</td>			<td style="height:14.0pt; width:237.7pt">			<p>Web应用安全</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>数据库安全</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:18.35pt; width:237.7pt">			<p>中间件应用安全</p>			</td>			<td style="height:18.35pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>应用层协议分析</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p><strong>&radic;</strong></p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>移动应用安全</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>VPN应用</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>恶意代码分析</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td rowspan="2" style="height:14.0pt; width:106.95pt">			<p>5.密码学</p>			</td>			<td style="height:14.0pt; width:237.7pt">			<p>密码学原理</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>密码学应用</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td rowspan="3" style="height:14.0pt; width:106.95pt">			<p>6.渗透测试</p>			</td>			<td style="height:14.0pt; width:237.7pt">			<p>常用工具</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p><strong>&radic;</strong></p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>脚本编写</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>报告编写</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>	</tbody></table><p>【难度说明】</p><table border="1" cellspacing="0" style="width:0px">	<tbody>		<tr>			<td style="vertical-align:top; width:142.0pt">			<p><strong>序号</strong></p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p><strong>难度等级</strong></p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p><strong>打勾&radic;</strong></p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:142.0pt">			<p>1</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>简单</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:142.0pt">			<p>2</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>一般</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p><strong>&radic;</strong></p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:142.0pt">			<p>3</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>困难</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:142.0pt">			<p>4</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>极难</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>&nbsp;</p>			</td>		</tr>	</tbody></table><p>【背景描述】</p><p>某黑客进入了一家公司内部办公网络局域网，然后他开始对其员工电脑进行攻击，希望以此来获得一些账户、密码、以及机密资料</p><p>&nbsp;【实训设备】</p><table border="1" cellspacing="0" style="width:0px">	<tbody>		<tr>			<td style="vertical-align:top; width:4.0cm">			<p>产品型号</p>			</td>			<td style="vertical-align:top; width:199.5pt">			<p>产品描述</p>			</td>			<td style="vertical-align:top; width:69.8pt">			<p>数量</p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:4.0cm">			<p>PY-P8</p>			</td>			<td style="vertical-align:top; width:199.5pt">			<p>实训室安全、应用环境实训平台</p>			</td>			<td style="vertical-align:top; width:69.8pt">			<p>1</p>			</td>		</tr>	</tbody></table><p><strong>【预备知识】</strong></p><p>在一个局域网中不可以有两个相同的IP，否则就会发生冲突，结果必然是其中一台机器无法上网。假设在局域网中有两台主机甲和乙，主机甲只知道乙的IP而不知道其MAC，主机甲想与主机乙进行通讯时，根据OSI七层模型，当数据封锁到数据链路层时（也就是MAC层），便会向局域网内所有机器发送一个arp请求包。这时如果乙收到该请求包，便会返回给甲一个arp应答包，将自己的MAC告诉甲，这样就可以继续进行数据传输了。但是如果在这个过程中，如果主机甲在发送ARP请求时，该局域网内有一台主机丙的IP和甲相同，丙就会得知有一台主机的IP地址同自己的IP地址相同，于是就弹出一个我们通常所见到的IP冲突的对话框。既然一个主机接收到自己相同IP发出的ARP请求就会弹出一个IP冲突框来，加入伪造任一台主机的IP向局域网不停地发送ARP请求，同时自己的MAC也是伪造的，那么被伪造IP的主机便会不停地收到IP冲突提示，这便构成了局域网的攻击原理。</p><p>ettercap利用计算机在局域网内进行通信的ARP协议的缺陷进行攻击，在目标与服务器之间充当中间人，嗅探两者之间的数据流量，从中窃取用户的数据资料。</p><p>&nbsp;</p><p>【实验步骤】</p><p>&nbsp;&nbsp;网络拓扑：bt5--01-server2003</p><p>&nbsp; bt5&nbsp;<br />&nbsp; 用户：root<br />&nbsp; 密码：toor</p><p>&nbsp; windows server 2003<br />&nbsp; 用户：administrator<br />&nbsp; 密码：123456</p><p><strong>【第一步】点击启动选项，启动实验虚拟机。</strong></p><p><strong>【第二步】获取操作机和靶机的IP</strong></p><p>操作机：ifconfig</p><p>靶机：ipconfig</p><p>【使用到的命令】</p><p>BT5：</p><p><strong>【命令】</strong>ifconfig</p><p><strong>【解释】</strong>获取BT5的网卡信息</p><p>Windows Server：</p><p><strong>【命令】</strong>ipconfig</p><p><strong>【解释】</strong>获取Win 2003的网卡信息</p><p><strong>【第三步】在本地开启IP转发，否则被欺骗的主机将不能正常上网。</strong></p><p>为使受害者主机的数据包能够顺利收发，我们需在Linux BT5中开启IP转发功能:</p><p>【截图说明】</p><p>ip_forword状态为1时为打开状态，为0时为关闭状态。所以首先将&ldquo;1&rdquo;写入</p><p>ip_forword,然后查看其文本状态。</p><p>linux上开启IP_forward命令: echo 1 &gt;&gt; /proc/sys/net/ipv4/ip_forward</p><p>注意：当机器网络重新启动，这个数字会恢复default＝0，要修改的话，可以修改</p><p>/etc/sysctl.conf文件，永久生效。</p><p>【<strong>使用到的命令</strong>】</p><p>【命令】echo 1 &gt;&gt; /proc/sys/net/ipv4/ip_forward</p><p>【解释】echo 在linux中通常用来表示输出一个字符串，但是此处用来将字符串写入某个文件中，后面跟&gt;&gt;的固定格式，最后跟文件的路径以及文件名</p><p>【命令】cat /proc/sys/net/ipv4/ip_forward</p><p>【解释】linux中cat命令用来显示某个文件的内容，此处命令用来显示</p><p>/proc/sys/net/ipv4/目录下ip_forward文件的内容，如果显示1，表名上条命令成功地</p><p>将1写入ip_forword文件。</p><p>&nbsp;</p><p><strong>【第四步】用ettercap -help查看参数详细说明</strong></p><p>&nbsp;</p><p>【截图说明】</p><p>本次实验需要用到ettercap &ndash;G参数，打开ettercap的图形化界面。</p><p>&nbsp;</p><p>【<strong>使用到的命令</strong>】</p><p>【命令】ettercap -help</p><p>【解释】查看ettercap工具的使用参数</p><p><strong>【第五步】我们看到接上-G参数可以打开GUI界面，我们就来启动ettercap图形化界面</strong></p><p>&nbsp;</p><p>【截图说明】</p><p>Ettercap的图形化界面</p><p>【所使用到的命令】</p><p>【命令】ettercap &ndash;G</p><p>【解释】打开ettercap的图形界面，-G是GUI的意思。</p><p><strong>【第六步】查看win2003中所返回的网关的mac地址</strong></p><p>【截图说明】</p><p>被欺骗前的MAC地址</p><p>【所使用到的命令】</p><p>【命令】arp &ndash;a</p><p>【解释】显示Win 2003的mac地址缓存</p><p><strong>【第七步】扫描局域网主机</strong></p><p>依照顺序点击sniff-&gt;unified sniffing-&gt;选择网卡eth1-&gt;ok，然后hosts-&gt;scan for hosts进行网段中的主机探测，然后hosts-&gt;hosts list展现出结果。</p><p>&nbsp;</p><p>【截图说明】</p><p>扫描局域网，发现主机列表</p><p>&nbsp;</p><p><strong>【第八步】攻击目标选择</strong></p><p>将要攻击的目标【Windows2003】添加为目标1【点击192.168.134.163，再点击add to target 1】将网关192.168.134.2【网关添加至add to target 2】</p><p>&nbsp;</p><p>【截图说明】</p><p>选中Win 2003这台主机，点击&ldquo;Add to Target1&rdquo;</p><p><strong>【第九步】嗅探远程连接</strong></p><p>选择mitm-&gt;arp poisoning,点击后会弹出一个配置嗅探端口，此时选择sniff remote connections进行嗅探</p><p>【截图说明】</p><p>嗅探远程连接：窃听eth1网卡流经的数据包。</p><p><strong>【第十步】查看结果</strong></p><p>发现arp缓存列表网关mac变成了BT5的MAC，至此已经获得了192.168.134.163的流量。</p><p>【截图说明】</p><p>截图发现网关的MAC地址变成了BT5的MAC地址。</p><p>【截图说明】</p><p>BT5的MAC地址</p><p>【所使用到的命令】</p><p>【命令】arp -a</p><p>【解释】查看windows2003的arp缓存表</p><p>【命令】ifconfig</p><p>【解释】查看bt5的mac地址，如果windows2003arp缓存表中网关的mac地址是bt5的mac就证明被欺骗成功。</p><p>&nbsp;</p><p>【拓展知识】</p><p>关于mitm的其他几种攻击方式</p><p>【截图说明】</p><p>1．实验的攻击方式。</p><p>2．icmp欺骗：icmp欺骗即基于重定向（redirect）的路由欺骗技术。其基本原理是欺骗其他的主机，将自身伪装为最近的路由，因此其他主机会将数据包发送进来，然后作为中间人的攻击者再重新将其转发到真正的路由器上。于是我们便可以对这些数据包进行监听。当然，icmp欺骗不适用于交换机的环境，若本机在交换机的环境下则最好选择arp毒化的方式来进行攻击。icmp欺骗方式的参数是真实路由器的MAC和IP，参数形式为(MAC/IP)。</p><p>【例如】#Ettercap -M icmp:00:11:22:33:44:55/192.168.0.1</p><p>3．DHCP spoofing：DHCP欺骗的原理是将攻击者的本机伪装成DHCP服务器，代替真实的DHCP服务器给新接入网络的受害主机动态分配IP。这样的缺点是可能会与真实的DHCP服务器重复分配IP造成冲突，而且只能针对新接入网段的主机，难以影响到之前的主机。DHCP spoofing方式的参数是可以分配出去的IP地址池、子网掩码和DNS，参数形式为(ip_pool/netmask/dns)</p><p>【例如】#Ettercap -M dhcp:192.168.0.30,35,50-60/255.255.255.0/192.168.0.1<br />对应的含义是：将分配192.168.0.30，35，50-60之中的地址，子网掩码为255.255.255.0，DNS服务器为192.168.0.1。</p><p>4．Port Stealing：此攻击方式适用的环境为交换机下，且路由器中IP和MAC绑定，造成无法进行Arp欺骗。其基本思想是，既然无法欺骗路由器的IP和MAC对应关系，那么就欺骗交换机，使原本应该通过交换机端口到达目标主机的数据包被传入了攻击者的端口。<br />需要指出的是，由于这个方法只用于交换机环境，且会产生大量的数据包，可能会严重影响网络状况。</p><p>在Ettercap使用中，还存在关于交互模式的问题，如果启动Ettercap的时候没有指定参数-N选项，那么就默认自动选择了交互模式。如果在某些情况下不知到可以做什么，只要键入&lsquo;H&rsquo;就可以弹出帮助画面，可看到可执行命令的消息列表。</p><p>另外，该指出的是，Ettercap并不转发数据包，转发数据包的是操作系统，因此，在中间人攻击时需要启用操作系统的数据包转发功能。当然，如果只想用Ettercap做一个中间人而用其他工具来嗅探数据的话，可以加入参数-o (only-mitm)实现。</p><p>&nbsp;</p><p><strong>【第十一步】在Win 2003上ping 192.168.134.162 抓包分析ARP数据包</strong></p><p>【截图说明】</p><p>Sender MAC address：发送者MAC地址</p><p>Sender IP address：发送者IP地址</p><p>Target MAC address：目标MAC地址</p><p>Target IP address：目标IP地址</p><p>【解释】</p><p>Win 2003在ping 192.168.134.162时，向网关发送ICMP数据包，如果网关不知道ICMP数据包的目的MAC地址，则网关要发起ARP广播报文。此时网关的MAC、IP地址作为ARP报文源地址，可以发现网关的MAC已经成功被欺骗成为BT5的MAC地址，实验成功。</p><p>&nbsp;</p><p>实验结束，关闭虚拟机。</p>
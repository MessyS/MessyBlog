<p></p><p>【教学资源类别】</p><table border="1" cellspacing="0" style="width:100.0%">	<tbody>		<tr>			<td style="vertical-align:top; width:33.32%">			<p>序号</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>类别</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>打勾&radic;</p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:33.32%">			<p>1</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>学习资源</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>&radic;</p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:33.32%">			<p>2</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>单兵模式赛题资源</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:33.32%">			<p>3</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>分组对抗赛题资源</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>&nbsp;</p>			</td>		</tr>	</tbody></table><p>&nbsp;【教学资源名称】&nbsp;</p><p>&nbsp; 应用层协议分析-通过Windows2003网络服务搭建DHCP协议分析</p><p>&nbsp;【教学资源分类】</p><table border="1" cellspacing="0" style="width:100.0%">	<tbody>		<tr>			<td style="height:14.0pt; width:25.1%">			<p>一级大类</p>			</td>			<td style="height:14.0pt; width:55.78%">			<p>二级大类</p>			</td>			<td style="height:14.0pt; width:19.12%">			<p>打勾&radic;</p>			</td>		</tr>		<tr>			<td rowspan="5" style="height:14.0pt; width:25.1%">			<p>1.安全标准</p>			</td>			<td style="height:14.0pt; width:55.78%">			<p>法律法规</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td style="height:14.0pt; width:55.78%">			<p>行业标准</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td style="height:14.0pt; width:55.78%">			<p>安全意识</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td style="height:14.0pt; width:55.78%">			<p>应急响应</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td style="height:14.0pt; width:55.78%">			<p>安全评估</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td rowspan="2" style="height:14.0pt; width:25.1%">			<p>2.系统安全</p>			</td>			<td style="height:14.0pt; width:55.78%">			<p>Windows操作系统安全配置</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td style="height:14.0pt; width:55.78%">			<p>Linux操作系统安全配置</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td rowspan="2" style="height:14.0pt; width:25.1%">			<p>3.网络安全</p>			</td>			<td style="height:14.0pt; width:55.78%">			<p>网络设备安全</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td style="height:14.0pt; width:55.78%">			<p>网络协议分析</p>			</td>			<td style="height:14.0pt; width:19.12%">			<p>&radic;</p>			</td>		</tr>		<tr>			<td rowspan="7" style="height:14.0pt; width:25.1%">			<p>4.应用安全</p>			</td>			<td style="height:14.0pt; width:55.78%">			<p>Web应用安全</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td style="height:14.0pt; width:55.78%">			<p>数据库安全</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td style="height:14.0pt; width:55.78%">			<p>中间件应用安全</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td style="height:14.0pt; width:55.78%">			<p>应用层协议分析</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td style="height:14.0pt; width:55.78%">			<p>移动应用安全</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td style="height:14.0pt; width:55.78%">			<p>VPN应用</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td style="height:14.0pt; width:55.78%">			<p>恶意代码分析</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td rowspan="2" style="height:14.0pt; width:25.1%">			<p>5.密码学</p>			</td>			<td style="height:14.0pt; width:55.78%">			<p>密码学原理</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td style="height:14.0pt; width:55.78%">			<p>密码学应用</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td rowspan="3" style="height:14.0pt; width:25.1%">			<p>6.渗透测试</p>			</td>			<td style="height:14.0pt; width:55.78%">			<p>常用工具</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td style="height:14.0pt; width:55.78%">			<p>脚本编写</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>		<tr>			<td style="height:14.0pt; width:55.78%">			<p>报告编写</p>			</td>			<td style="height:14.0pt; width:19.12%">&nbsp;</td>		</tr>	</tbody></table><p>【难度说明】</p><table border="1" cellspacing="0" style="width:100.0%">	<tbody>		<tr>			<td style="vertical-align:top; width:33.32%">			<p>序号</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>难度等级</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>打勾&radic;</p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:33.32%">			<p>1</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>简单</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>&radic;</p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:33.32%">			<p>2</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>一般</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:33.32%">			<p>3</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>困难</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:33.32%">			<p>4</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>极难</p>			</td>			<td style="vertical-align:top; width:33.34%">			<p>&nbsp;</p>			</td>		</tr>	</tbody></table><p>【背景描述】</p><p>XX企业，为加强信息化建设，组建了企业内部网络，用于自身网站的建设，小王是该企业新进网管，承担网络的管理工作。</p><p>现该企业网络存在如下需求：</p><p>通过企业网络NIDS分析，经常发现网络中出现针对DHCP服务的DOS攻击，造成DHCP服务器宕机，针对此问题，需要提出针对此攻击的解决方案，再次之前，需要首先对DHCP协议的工作原理进行研究。</p><p>&nbsp;【实训设备】</p><table border="1" cellspacing="0">	<tbody>		<tr>			<td style="vertical-align:top; width:4.0cm">			<p>产品型号</p>			</td>			<td style="vertical-align:top; width:199.5pt">			<p>产品描述</p>			</td>			<td style="vertical-align:top; width:69.8pt">			<p>数量</p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:4.0cm">			<p>PY-P8</p>			</td>			<td style="vertical-align:top; width:199.5pt">			<p>实训室安全、应用环境实训平台</p>			</td>			<td style="vertical-align:top; width:69.8pt">			<p>1</p>			</td>		</tr>	</tbody></table><p>【预备知识】</p><p>DHCP（Dynamic Host Configuration Protocol，动态主机配置协议）使用UDP协议工作，采用67（DHCP服务器文）和68（DHCP客户端）两个端口号。546号端口用于DHCPv6 Client，而不用于DHCPv4，是为DHCP failover服务。</p><p>DHCP客户端向DHCP服务器发送的报文称之为DHCP请求报文，而DHCP服务器向DHCP客户端发送的报文称之为DHCP应答报文。</p><p>DHCP采用C/S（客户端/服务器）模式，可以为客户机自动分配IP地址、子网掩码以及缺省网关、DNS服务器的IP地址等，并能够提升地址的使用率。</p><p>相关术语：</p><p>1．DHCP报文种类</p><p>DHCP一共有8种报文，分别为DHCP Discover、DHCP Offer、DHCP Request、DHCP ACK、DHCP NAK、DHCP Release、DHCP Decline、DHCP Inform。各种类型报文的基本功能如下：</p><p>DHCP Discover</p><p>DHCP客户端在请求IP地址时并不知道DHCP服务器的位置，因此DHCP客户端会在本地网络内以广播方式发送Discover请求报文，以发现网络中的DHCP服务器。所有收到Discover报文的DHCP服务器都会发送应答报文，DHCP客户端据此可以知道网络中存在的DHCP服务器的位置。</p><p>DHCP Offer</p><p>DHCP服务器收到Discover报文后，就会在所配置的地址池中查找一个合适的IP地址，加上相应的租约期限和其他配置信息（如网关、DNS服务器等），构造一个Offer报文，发送给DHCP客户端，告知用户本服务器可以为其提供IP地址。但这个报文只是告诉DHCP客户端可以提供IP地址，最终还需要客户端通过ARP来检测该IP地址是否重复。</p><p>DHCP Request</p><p>DHCP客户端可能会收到很多Offer请求报文，所以必须在这些应答中选择一个。通常是选择第一个Offer应答报文的服务器作为自己的目标服务器，并向该服务器发送一个广播的Request请求报文，通告选择的服务器，希望获得所分配的IP地址。另外，DHCP客户端在成功获取IP地址后，在地址使用租期过去1/2时，会向DHCP服务器发送单播Request请求报文请求续延租约，如果没有收到ACK报文，在租期过去3/4时，会再次发送广播的Request请求报文以请求续延租约。</p><p>DHCP ACK</p><p>DHCP服务器收到Request请求报文后，根据Request报文中携带的用户MAC来查找有没有相应的租约记录，如果有则发送ACK应答报文，通知用户可以使用分配的IP地址。</p><p>DHCP NAK</p><p>如果DHCP服务器收到Request请求报文后，没有发现有相应的租约记录或者由于某些原因无法正常分配IP地址，则向DHCP客户端发送NAK应答报文，通知用户无法分配合适的IP地址。</p><p>DHCP Release</p><p>当DHCP客户端不再需要使用分配IP地址时，就会主动向DHCP服务器发送RELEASE请求报文，告知服务器用户不再需要分配IP地址，请求DHCP服务器释放对应的IP地址。</p><p>DHCP Decline</p><p>DHCP客户端收到DHCP服务器ACK应答报文后，通过地址冲突检测发现服务器分配的地址冲突或者由于其他原因导致不能使用，则会向DHCP服务器发送Decline请求报文，通知服务器所分配的IP地址不可用，以期获得新的IP地址。</p><p>DHCP Inform</p><p>DHCP客户端如果需要从DHCP服务器端获取更为详细的配置信息，则向DHCP服务器发送Inform请求报文；DHCP服务器在收到该报文后，将根据租约进行查找到相应的配置信息后，向DHCP客户端发送ACK应答报文。目前基本上不用了。</p><p>2．DHCP报文格式</p><p>DHCP服务的8种报文的格式是相同的，不同类型的报文只是报文中的某些字段取值不同。DHCP报文格式基于BOOTP的报文格式。下面是各字段的说明。</p><p>OP：报文的操作类型。分为请求报文和响应报文。1：请求报文，2：应答报文。即client送给server的封包，设为1，反之为2。</p><p>请求报文：DHCP Discover、DHCP Request、DHCP Release、DHCP Inform和DHCP Decline。</p><p>应答报文：DHCP Offer、DHCP ACK和DHCP NAK。</p><p>Htype：DHCP客户端的MAC地址类型。MAC地址类型其实是指明网络类型，Htype值为1时表示为最常见的以太网MAC地址类型。</p><p>Hlen：DHCP客户端的MAC地址长度。以太网MAC地址长度为6个字节，即以太网时Hlen值为6。</p><p>Hops：DHCP报文经过的DHCP中继的数目，默认为0。DHCP请求报文每经过一个DHCP中继，该字段就会增加1。没有经过DHCP中继时值为0。(若数据包需经过router传送，每站加1，若在同一网内，为0。)</p><p>Xid：客户端通过DHCP Discover报文发起一次IP地址请求时选择的随机数，相当于请求标识。用来标识一次IP地址请求过程。在一次请求中所有报文的Xid都是一样的。</p><p>Secs：DHCP客户端从获取到IP地址或者续约过程开始到现在所消耗的时间，以秒为单位。在没有获得IP地址前该字段始终为0。(DHCP客户端开始DHCP请求后所经过的时间。目前尚未使用，固定为0。)</p><p>Flags：标志位，只使用第0比特位，是广播应答标识位，用来标识DHCP服务器应答报文是采用单播还是广播发送，0表示采用单播发送方式，1表示采用广播发送方式。其余位尚未使用。(即从0-15bits，最左1bit为1时表示server将以广播方式传送封包给client。)</p><p>【注意】在客户端正式分配了IP地址之前的第一次IP地址请求过程中，所有DHCP报文都是以广播方式发送的，包括客户端发送的DHCP Discover和DHCP Request报文，以及DHCP服务器发送的DHCP Offer、DHCP ACK和DHCP NAK报文。当然，如果是由DHCP中继器转的报文，则都是以单播方式发送的。另外，IP地址续约、IP地址释放的相关报文都是采用单播方式进行发送的。</p><p>Ciaddr：DHCP客户端的IP地址。仅在DHCP服务器发送的ACK报文中显示，在其他报文中均显示0，因为在得到DHCP服务器确认前，DHCP客户端是还没有分配到IP地址的。只有客户端是Bound、Renew、Rebinding状态，并且能响应ARP请求时，才能被填充。</p><p>Yiaddr：DHCP服务器分配给客户端的IP地址。仅在DHCP服务器发送的Offer和ACK报文中显示，其他报文中显示为0。</p><p>Siaddr：下一个为DHCP客户端分配IP地址等信息的DHCP服务器IP地址。仅在DHCP Offer、DHCP ACK报文中显示，其他报文中显示为0。(用于bootstrap过程中的IP地址)</p><p>Giaddr：DHCP客户端发出请求报文后经过的第一个DHCP中继的IP地址。如果没有经过DHCP中继，则显示为0。(转发代理（网关）IP地址)</p><p>Chaddr：DHCP客户端的MAC地址。在每个报文中都会显示对应DHCP客户端的MAC地址。</p><p>Sname：为DHCP客户端分配IP地址的DHCP服务器名称（DNS域名格式）。在Offer和ACK报文中显示发送报文的DHCP服务器名称，其他报文显示为0。</p><p>File：DHCP服务器为DHCP客户端指定的启动配置文件名称及路径信息。仅在DHCP Offer报文中显示，其他报文中显示为空。</p><p>Options：可选项字段，长度可变，格式为&quot;代码+长度+数据&quot;。</p><p>列出部分可选的选项：</p><p>代码1</p><p>长度(字节)：4</p><p>说明：子网掩码</p><p>代码3</p><p>长度：长度可变，必须是4个字节的倍数。</p><p>说明：默认网关（可以是一个路由器IP地址列表）</p><p>代码6</p><p>长度：长度可变，必须是4个字节的整数倍。</p><p>说明DNS服务器（可以是一个DNS服务器IP地址列表）</p><p>代码15</p><p>长度：长度可变</p><p>说明：域名称（主DNS服务器名称）</p><p>代码44</p><p>长度：长度可变，必须是4个字节的整数倍。</p><p>说明：WINS服务器（可以是一个WINS服务器IP列表）</p><p>代码51</p><p>长度：4</p><p>说明：有效租约期（以秒为单位）</p><p>代码53</p><p>长度：1</p><p>说明：报文类型</p><p>1: DHCP Discover</p><p>2: DHCP Offer</p><p>3: DHCP Request</p><p>4: DHCP Decline</p><p>5: DHCP ACK</p><p>6: DHCP NAK</p><p>7: DHCP Release</p><p>8: DHCP Inform</p><p>代码58</p><p>长度：4</p><p>说明：续约时间</p><p>【实验步骤】</p><p>网络拓扑：BackTrack5--Windows2003--Windows2003</p><p>bt5&nbsp;<br />用户：root<br />密码：toor</p><p>windows server 2003<br />用户：administrator<br />密码：空</p><p>第一步：配置服务器的IP地址</p><p>服务器：202.100.1.20</p><p>第二步：确保服务器安装了DHCP服务</p><p>第三步：配置DHCP作用域</p><p>&nbsp;</p><p>第四步：激活作用域</p><p>第五步：验证客户机获得服务器DHCP服务分配的IP地址</p><p>第六步：通过Shell命令释放客户机动态获得的IP地址</p><p>第七步：打开WireShark程序，并配置过滤条件</p><p>&nbsp;</p><p>第八步：验证客户机获得服务器DHCP服务分配的IP地址</p><p>第九步：打开WireShark，对照预备知识，验证如下数据对象</p><p>1、客户机向其所在网络发送DHCP Discovery数据包，用于请求这个终端所使用的访问网络的IP地址；</p><p>从这个包可以看出，用户终端没有任何IP地址，为0.0.0.0，但是它通过一个Client MAC地址去向DHCP服务器申请IP地址；</p><p>2、DHCP服务器收到这个请求，会为用户终端回送DHCP Offer；</p><p>从这个包可以看出，DHCP服务器为刚才那个用户终端的MAC分配的IP地址为202.100.1.100，并且这个IP携带了一些选项，例如子网掩码、网关、DNS、DHCP服务器IP、租期等信息；</p><p>3、用户终端收到这个Offer以后，确认需要使用这个IP地址，会向DHCP服务器继续发送DHCP Request；</p><p>从这个包可以看出，用户终端请求IP地址202.100.1.100；</p><p>4、DHCP服务器再次收到来自这个用户终端的请求，会回送DHCP ACK包进行确认，至此，用户终端获得DHCP服务器为其分配的IP地址；</p><p>&nbsp;</p><p>&nbsp;</p><p>实验结束，关闭虚拟机。</p>
<p></p><p>【教学资源类别】</p><table border="1" cellspacing="0" style="width:0px">	<tbody>		<tr>			<td style="vertical-align:top; width:142.0pt">			<p><strong>序号</strong></p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p><strong>类别</strong></p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p><strong>打勾&radic;</strong></p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:142.0pt">			<p>1</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>学习资源</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p><strong>&radic;</strong></p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:142.0pt">			<p>2</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>单兵模式赛题资源</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:142.0pt">			<p>3</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>分组对抗赛题资源</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>&nbsp;</p>			</td>		</tr>	</tbody></table><p>【教学资源名称】&nbsp;</p><p>渗透测试常用工具-使用xprobe2进行操作系统识别</p><p>&nbsp;【教学资源分类】</p><table border="1" cellspacing="0" style="width:0px">	<tbody>		<tr>			<td style="height:14.0pt; width:106.95pt">			<p><strong>一级大类</strong></p>			</td>			<td style="height:14.0pt; width:237.7pt">			<p><strong>二级大类</strong></p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p><strong>打勾&radic;</strong></p>			</td>		</tr>		<tr>			<td rowspan="5" style="height:14.0pt; width:106.95pt">			<p>1.安全标准</p>			</td>			<td style="height:14.0pt; width:237.7pt">			<p>法律法规</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>行业标准</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>安全意识</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>应急响应</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>安全评估</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td rowspan="2" style="height:14.0pt; width:106.95pt">			<p>2.系统安全</p>			</td>			<td style="height:14.0pt; width:237.7pt">			<p>Windows操作系统安全配置</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>Linux操作系统安全配置</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td rowspan="2" style="height:14.0pt; width:106.95pt">			<p>3.网络安全</p>			</td>			<td style="height:14.0pt; width:237.7pt">			<p>网络设备安全</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>网络协议分析</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td rowspan="7" style="height:14.0pt; width:106.95pt">			<p>4.应用安全</p>			</td>			<td style="height:14.0pt; width:237.7pt">			<p>Web应用安全</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>数据库安全</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>中间件应用安全</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>应用层协议分析</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p><strong>&radic;</strong></p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>移动应用安全</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>VPN应用</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>恶意代码分析</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td rowspan="2" style="height:14.0pt; width:106.95pt">			<p>5.密码学</p>			</td>			<td style="height:14.0pt; width:237.7pt">			<p>密码学原理</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>密码学应用</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td rowspan="3" style="height:14.0pt; width:106.95pt">			<p>6.渗透测试</p>			</td>			<td style="height:14.0pt; width:237.7pt">			<p>常用工具</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p><strong>&radic;</strong></p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>脚本编写</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="height:14.0pt; width:237.7pt">			<p>报告编写</p>			</td>			<td style="height:14.0pt; width:81.45pt">			<p>&nbsp;</p>			</td>		</tr>	</tbody></table><p>【难度说明】</p><table border="1" cellspacing="0" style="width:0px">	<tbody>		<tr>			<td style="vertical-align:top; width:142.0pt">			<p><strong>序号</strong></p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p><strong>难度等级</strong></p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p><strong>打勾&radic;</strong></p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:142.0pt">			<p>1</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>简单</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p><strong>&radic;</strong></p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:142.0pt">			<p>2</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>一般</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:142.0pt">			<p>3</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>困难</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>&nbsp;</p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:142.0pt">			<p>4</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>极难</p>			</td>			<td style="vertical-align:top; width:142.05pt">			<p>&nbsp;</p>			</td>		</tr>	</tbody></table><p>【背景描述】</p><p>XX企业，为加强信息化建设，组建了企业内部网络，用于自身网站的建设，小王是该企业新进网管，承担网络的管理工作。</p><p>现该企业网络存在如下需求：</p><p>&nbsp;查看内网的主机操作系统及开放的端口</p><p>&nbsp;【实训设备】</p><table border="1" cellspacing="0" style="width:0px">	<tbody>		<tr>			<td style="vertical-align:top; width:146.65pt">			<p>产品型号</p>			</td>			<td style="vertical-align:top; width:166.25pt">			<p>产品描述</p>			</td>			<td style="vertical-align:top; width:69.8pt">			<p>数量</p>			</td>		</tr>		<tr>			<td style="vertical-align:top; width:146.65pt">			<p>PY-P8</p>			</td>			<td style="vertical-align:top; width:166.25pt">			<p>实训室安全、应用环境实训平台</p>			</td>			<td style="vertical-align:top; width:69.8pt">			<p>1</p>			</td>		</tr>	</tbody></table><p>【预备知识】</p><p>xprobe是一款远程主机操作系统探查工具。开发者基于和Nmap相同的一些技术（same techniques），并加入了自己的创新。Xprobe通过ICMP协议来获得指纹。最新版本是Xprobe2.0.3版本,Xprobe2通过模糊矩阵统计分析主动探测数据报对应的ICMP数据报特征,进而探测得到远端操作系统的类型。</p><p>【实验步骤】</p><p>&nbsp;&nbsp;网络拓扑：bt5--01-server2003</p><p>&nbsp; bt5&nbsp;<br />&nbsp; 用户：root<br />&nbsp; 密码：toor</p><p>&nbsp; windows server 2003<br />&nbsp; 用户：administrator<br />&nbsp; 密码：123456</p><p><strong>【第一步】点击启动选项，启动实验虚拟机。</strong></p><p><strong>【第二步】获取操作机和靶机的IP</strong></p><p>&nbsp;&nbsp; 操作机：<strong>ifconfig</strong></p><p>靶机：ipconfig</p><p>&nbsp;</p><p>&nbsp; 【<strong>使用到的命令</strong>】</p><p>BT5：通过ifconfig获取</p><p>Windows Server：通过ipconfig获取</p><p>&nbsp;</p><p>&nbsp;【<strong>工具原理</strong>】</p><p>TTL是IP协议包中的一个值，它告诉网络路由器包在网络中的时间是否太长而应被丢弃。有很多原因使包在一定时间内不能被传递到目的地。</p><p>&nbsp;</p><p>例如，不正确的路由表可能导致包的无限循环。所以需要在包中设置这样一个值，包在每经过一个节点，将这个值减1，反复这样操作，最终可能造成两个结果：包在这个值还为正数的时候到达了目的地，或者是在经过一定数量的节点后，这个值减为了0。前者代表完成了一次正常的传输，后者代表包可能选择了一条非常长的路径甚至是进入了环路，这显然不是我们期望的，所以在这个值为0的时候，网络设备将不会再传递这个包而是直接将他抛弃，并发送一个通知给包的源地址，说这个包已死。</p><p>通过TTL值我们能得到什么 其实TTL值这个东西本身并代表不了什么，对于使用者来说，关心的问题应该是包是否到达了目的地而不是经过了几个节点后到达。但是TTL值还是可以得到有意思的信息的。</p><p>每个操作系统对TTL值得定义都不同，这个值甚至可以通过修改某些系统的网络参数来修改，例如Win2000默认为128，通过注册表也可以修改。而Linux大多定义为64。不过一般来说，很少有人会去修改自己机器的这个值的，这就给了我们机会可以通过ping的回显TTL来大体判断一台机器是什么操作系统。如你看到112，可能是初始128，跳了16个节点，或者是初始160，跳了48次。</p><p>不同的操作系统，它的TTL值默认值是不相同的。默认情况下，Linux系统的TTL值为64或255，Windows NT/2000/XP系统的TTL值为128，Windows 98系统的TTL值为32，UNIX主机的TTL值为255。</p><p>&nbsp;</p><p>从PING命令的回显可以判断操作系统类型</p><p>就是使用PING命令来查看TTL值从而判断操作系统类型。详细如下：</p><p>TTL=128，这是WINNT/2K/XP。</p><p>TTL=32，这是WIN95/98/ME。</p><p>TTL=256，这是UNIX。</p><p>TTL=64，这是LINUX。</p><p>&nbsp;</p><p><strong>【第三步】使用wireshark 分析一下数据包</strong></p><p>使用一个简单的命令xprobe2 172.16.20.136使用wireshark进行抓包分析</p><p>&nbsp;</p><p>首先通过arp协议判断目标机器的存活 如果存活 靶机返回一个reply的包 然后使用icmp对操作系统进行判断</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>通过ICMP协议判断操作系统的类型</p><p>&nbsp;</p><p>TTL=128，这是WINNT/2K/XP。</p><p>TTL=32，这是WIN95/98/ME。</p><p>TTL=256，这是UNIX。</p><p>TTL=64，这是LINUX。</p><p>&nbsp;</p><p><strong>【第四步】对主机（Windows Server）进行扫描</strong></p><p>从BT5主机输入xprobe2我们可以获取到xprobe的一些用法命令</p><p>以及版本的一些信息</p><p>-v&nbsp; 版本信息</p><p>-r显示路由到目标（traceroute）</p><p>-p指定端口号，协议和状态。</p><p>例如：tcp：23：open，UDP：53：CLOSED</p><p>-c指定要使用的配置文件。</p><p>-h打印此帮助。</p><p>-o使用日志文件记录一切。</p><p>-t设置初始接收超时或往返时间。</p><p>-s设置包装发送延迟（毫秒）。</p><p>-d指定调试级别。</p><p>-D禁用模块号码。</p><p>-M启用模块号码。</p><p>-L显示模块。</p><p>-T为指定的端口启用TCP端口扫描。</p><p>&nbsp;&nbsp;&nbsp; 例如：-T21-23,53,110</p><p>-U为指定的端口启用UDP端口扫描。</p><p>-X生成XML输出并将其保存到使用-o指定的日志文件中。</p><p>-B使用TCP握手模块尝试猜测开放的TCP端口&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>&nbsp;</p><p><strong>【第四步】对主机进行扫描 常用的有以下几种扫描方式</strong></p><p>&nbsp;</p><p>首先我们看一下xprobe2 -L 查看一下xprobe2所包含的模板</p><p>&nbsp;</p><p>&nbsp;xprobe2包含以下模块：</p><p>&middot; icmp_ping: ICMP回显探索模块</p><p>&middot; tcp_ping: 基于TCP的ping探索模块</p><p>&middot; udp_ping: 基于UDP的ping探索模块</p><p>&middot; ttl_calc: 基于TCP和UDP的 TTL距离计算</p><p>&middot; portscan: TCP 与 UDP 端口扫描</p><p>&middot; icmp_echo: ICMP回显请求指纹识别模块</p><p>&middot; icmp_tstamp: ICMP时间戳请求指纹识别模块</p><p>&middot; icmp_amask: ICMP地址掩码请求指纹识别模块</p><p>&middot; icmp_port_unreach: ICMP端口不可达指纹识别模块</p><p>&middot; tcp_hshake: TCP握手指纹识别模块</p><p>&middot; tcp_rst: TCP RST指纹识别模块</p><p>&middot; smb: SMB指纹识别模块</p><p>&middot; snmp: SNMPv2c指纹识别模块</p><p>&nbsp;</p><p>通过结果 我们可以发现他所包含Ping:icmp_ping&nbsp; ping:tcp_ping等 很多模块，这些模块是我们进行机器扫描时候所加载进去的 比如icmp_ping 这个模块 通过这个模块 我们快速探测到主机的存活 ，portscan 模块可以进行对机器端口的一些扫描</p><p>&nbsp;</p><p><strong>【第一种】 使用xprobe2 +ip进行扫描</strong></p><p><strong>【命令】</strong>xprobe2 【IP】&nbsp;</p><p><strong>【例如】</strong>xprobe2 172.16.20.136</p><p>这里是我们调用的模块</p><p>这里是我们用过调用snmp模块然后判断操作系统的 然后 如果不存在snmp漏洞 一般判断方式是通过icmp协议判断的</p><p>&nbsp;</p><p>[+]目标是172.16.20.136</p><p>[+]加载模块。</p><p>[+]加载以下模块：</p><p>[x] ping：icmp_ping - ICMP回显发现模块</p><p>[x] ping：tcp_ping - 基于TCP的ping发现模块</p><p>[x] ping：udp_ping - 基于UDP的ping发现模块</p><p>[x] infogather：ttl_calc - 基于TCP和UDP的TTL距离计算</p><p>[x] infogather：portscan - TCP和UDP PortScanner</p><p>[x]指纹：icmp_echo - ICMP回声请求指纹识别模块</p><p>[x]指纹：icmp_tstamp - ICMP时间戳请求指纹模块</p><p>[x]指纹：icmp_amask - ICMP地址掩码请求指纹模块</p><p>[x]指纹：icmp_info - ICMP信息请求指纹模块</p><p>[x]指纹：icmp_port_unreach - ICMP端口不可达指纹识别模块</p><p>[x]指纹：tcp_hshake - TCP握手指纹模块</p><p>[x]指纹：tcp_rst - TCP RST指纹识别模块</p><p>[x] app：smb - SMB指纹模块</p><p>[x] app：snmp - SNMPv2c指纹识别模块</p><p>[x] app：ftp - FTP指纹测试</p><p>[x] app：http - HTTP指纹测试</p><p>[+] 16个模块注册</p><p>[+]初始化扫描引擎</p><p>[+]运行扫描引擎</p><p>指纹：icmp_tstamp没有足够的数据</p><p>执行ping：icmp_ping</p><p>执行指纹：icmp_port_unreach</p><p>指纹：tcp_hshake没有足够的数据</p><p>执行指纹：tcp_rst</p><p>执行指纹：icmp_echo</p><p>执行指纹：icmp_amask</p><p>执行指纹：icmp_info</p><p>执行指纹：icmp_tstamp</p><p>应用程序：smb没有足够的数据</p><p>执行app：snmp</p><p>[+] SNMP [社区：公共] [sysDescr.0：硬件：x86系列6型号61步进4 AT / AT COMPATIBLE - 软件：Windows版本5.2（内部版本3790免处理器）]</p><p>ping：tcp_ping没有足够的数据</p><p>ping：udp_ping没有足够的数据</p><p>infogather：ttl_calc没有足够的数据</p><p>执行infogather：portscan</p><p>执行应用程序：ftp</p><p>执行应用程序：http</p><p>[+]初级网络猜测：</p><p>[+]主机172.16.20.136运行操作系统：&ldquo;Microsoft Windows XP SP2&rdquo;（猜测概率：100％）</p><p>[+]其他猜测：</p><p>[+]主机172.16.20.136运行操作系统：&ldquo;Microsoft Windows 2003服务器企业版&rdquo;（猜测概率：100％）</p><p>[+]主机172.16.20.136运行操作系统：&ldquo;Microsoft Windows 2003服务器标准版&rdquo;（猜测概率：100％）</p><p>[+]主机172.16.20.136运行操作系统：&ldquo;Microsoft Windows 2000 Server Service Pack 1&rdquo;（猜测概率：100％）</p><p>[+]主机172.16.20.136运行操作系统：&ldquo;Microsoft Windows 2000 Server&rdquo;（猜测概率：100％）</p><p>[+]主机172.16.20.136运行操作系统：&ldquo;Microsoft Windows 2000 Workstation SP4&rdquo;（猜测概率：100％）</p><p>[+]主机172.16.20.136运行操作系统：&ldquo;Microsoft Windows 2000 Workstation SP3&rdquo;（猜测概率：100％）</p><p>[+]主机172.16.20.136运行操作系统：&ldquo;Microsoft Windows 2000 Workstation SP2&rdquo;（猜测概率：100％）</p><p>[+]主机172.16.20.136运行操作系统：&ldquo;Microsoft Windows 2000 Workstation SP1&rdquo;（猜测概率：100％）</p><p>[+]主机172.16.20.136运行操作系统：&ldquo;Microsoft Windows 2000 Workstation&rdquo;（猜测概率：100％）</p><p>[+]清理扫描引擎</p><p>[+]模块被初始化</p><p>[+]执行完成。</p><p>&nbsp;</p><p>我们可以发现识别到了操作系统的类型windows 2000/2003</p><p>&nbsp;</p><p>【<strong>第二种】使用xprobe2 -T【端口】 ip进行扫描 </strong></p><p><strong>【命令】</strong>xprobe2 -T【端口】 ip</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong>【例如】</strong> xprobe2 -T1-4000 172.16.20.136 ，</p><p>1-4000是端口的一个范围 如果指定端口的话 就是-T21,22,3389 ip就是这样的</p><p>端口和端口之间要用逗号隔开</p><p>&nbsp;<img src="api/attachment?type=courseDocument&amp;id=1389" style="height:318px; width:474px" /></p><p>这里是xprobe调用的模块</p><p>这里是调用的portscan这个模块对端口进行的扫描</p><p>通过结果可以发现开放了80 135 139 445 1026 3306 3389端口</p><p>&nbsp;</p><p><strong>【第三种】使用xprobe2 -T【端口】 ip进行扫描 同时可以进行UDP端口</strong></p><p><strong>&nbsp;</strong><strong>的扫描</strong></p><p><strong>【命令】</strong>xprobe2 -U【端口】 ip</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong>【例如】</strong>xprobe2 -U1-1000 172.16.20.136</p><p>1-1000是端口的一个范围 如果指定端口的话 就是-T21,22,3389 ip就是这样的&nbsp;</p><p>端口和端口之间要用逗号隔开</p><p>这里是调用的模块</p><p>&nbsp;</p><p>这里调用portscan这个模块 通过扫描结果 我们可以看到udp开放的结果</p><p>&nbsp;</p><p><strong>【第四种】使用xprobe2 可以禁止调用一些模块 </strong></p><p>【命令】xprobe2 -ip -D 【模块】</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 【例如】xprobe2 -172.16.20.136 -D app:snmp</p><p>禁用snmp模块</p><p>结果可以发现并没有调用snmp模块&nbsp; 原本是16个模块 现在15个模块&nbsp;</p><p>&nbsp;</p><p>实验结束，关闭虚拟机。</p>